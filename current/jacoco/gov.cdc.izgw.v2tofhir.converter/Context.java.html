<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Context.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HL7 Version 2 to FHIR Conversion</a> &gt; <a href="index.source.html" class="el_package">gov.cdc.izgw.v2tofhir.converter</a> &gt; <span class="el_source">Context.java</span></div><h1>Context.java</h1><pre class="source lang-java linenums">package gov.cdc.izgw.v2tofhir.converter;

import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.LinkedHashSet;
import java.util.Map;
import java.util.Set;

import org.apache.commons.lang3.StringUtils;
import org.hl7.fhir.r4.model.Bundle;

import lombok.Data;

/**
 * Context keeps track of important decision making variables during the parse of an HL7 message.
 * 
 * Different parsing decisions may be made depending on the type of event. For
 * example, RXA segments may be parsed into the Immunization resource instead of
 * a MedicationAdministration resource when the message is being parsed for a 
 * VXU message or a QPD response to an immunization query.
 * 
 * In order to make these decisions, Context provides a place to store information
 * about previously created objects.
 * @param &lt;P&gt; The parser to use
 */
@Data
public class Context&lt;P extends Parser&lt;?, ?&gt;&gt; {
	/**
	 * The event that generated the message, used to provide context during parsing.
	 */
	private String eventCode;
	/**
	 * The profile identifiers the message adheres to.
	 */
<span class="fc" id="L35">	private final Set&lt;String&gt; profileIds = new LinkedHashSet&lt;&gt;();</span>
	/**
	 * The bundle being created.
	 */
	private Bundle bundle;
	
<span class="fc" id="L41">	private boolean generatingOriginalText = true;</span>

	/**
	 * Whether or not Provenance resources should be created. 
	 */
<span class="fc" id="L46">	private boolean storingProvenance = true;</span>
	/**
	 * Whether or not to log a message on a processor load failure
	 */
<span class="fc" id="L50">	private boolean warnOnFailedLoad = false;</span>
	/**
	 * Other properties associated with this context.
	 */
<span class="fc" id="L54">	private final Map&lt;String, Object&gt; properties = new LinkedHashMap&lt;&gt;();</span>
	
	private final P parser;
	
	/** 
	 * Create a new Context for use with the given message parser.
	 * 
	 * @param parser	The message parser using this context.
	 */
<span class="fc" id="L63">	public Context(P parser) {</span>
<span class="fc" id="L64">		this.parser = parser;</span>
<span class="fc" id="L65">	}</span>
	
	/**
	 * Reset the context for a new message parse.
	 */
	public void clear() {
<span class="fc" id="L71">		properties.clear();</span>
<span class="fc" id="L72">		setBundle(null);</span>
<span class="fc" id="L73">		setEventCode(null);</span>
<span class="fc" id="L74">	}</span>
	
	/**
	 * Add the profile identifier to the context
	 * @param profileId
	 */
	public void addProfileId(String profileId) {
<span class="pc bpc" id="L81" title="2 of 4 branches missed.">		if (profileId == null || StringUtils.isEmpty(profileId)) {</span>
<span class="nc" id="L82">			return;</span>
		}
<span class="fc" id="L84">		profileIds.add(profileId);</span>
<span class="fc" id="L85">	}</span>
	/** 
	 * Get the properties for the context as an unmodifiable map.
	 * 
	 * @return The properties set in this context.
	 */
	public Map&lt;String, Object&gt; getProperties() {
<span class="nc" id="L92">		return Collections.unmodifiableMap(properties);</span>
	}
	
	/**
	 * Get a given property
	 * @param key	The property to find.
	 * @return	The property value, or null if not found.
	 */
	public Object getProperty(String key) {
<span class="fc" id="L101">		return properties.get(key);</span>
	}
	
	/**
	 * Get a property of the given type. 
	 * 
	 * The key will be the class name of the property type.
	 * @see #getProperty(Class,String) 
	 *
	 * @param &lt;T&gt;	The property type
	 * @param clazz	The class representing the property type
	 * @return	The property that was found, or null if not found.
	 */
	public &lt;T&gt; T getProperty(Class&lt;T&gt; clazz) {
<span class="fc" id="L115">		return clazz.cast(getProperty(clazz.getName()));</span>
	}
	
	/**
	 * Get a property of the given type. 
	 * 
	 * The key will be the class name of the property type.
	 * 
	 * @param &lt;T&gt;	The property type
	 * @param clazz	The class representing the property type
	 * @param key The lookup key for the property
	 * @return	The property that was found, or null if not found.
	 */
	public &lt;T&gt; T getProperty(Class&lt;T&gt; clazz, String key) {
<span class="nc" id="L129">		return clazz.cast(getProperty(key));</span>
	}
	
	/**
	 * Add or replace a property in the context with a new value.
	 * 
	 * The property will be created with the key obj.getClass().getName().
	 * @see #setProperty(String,Object) 
	 * @param obj	The object containing the property value	
	 */
	public void setProperty(Object obj) {
<span class="fc" id="L140">		properties.put(obj.getClass().getName(), obj);</span>
<span class="fc" id="L141">	}</span>
	
	/**
	 * Set the property with the specified key to the value of the specified object.
	 * 
	 * @param key	The key to store the property under 
	 * @param obj	The object containing the property value	
	 */
	public void setProperty(String key, Object obj) {
<span class="fc" id="L150">		properties.put(key, obj);</span>
<span class="fc" id="L151">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>