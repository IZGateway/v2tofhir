<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Property.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HL7 Version 2 to FHIR Conversion</a> &gt; <a href="index.source.html" class="el_package">com.ainq.fhir.utils</a> &gt; <span class="el_source">Property.java</span></div><h1>Property.java</h1><pre class="source lang-java linenums">package com.ainq.fhir.utils;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Collections;
import java.util.List;
import java.util.ServiceConfigurationError;

import org.apache.commons.lang3.StringUtils;
import org.hl7.fhir.exceptions.FHIRException;
import org.hl7.fhir.instance.model.api.IBase;
import org.hl7.fhir.instance.model.api.IBaseExtension;
import org.hl7.fhir.instance.model.api.IBaseReference;
import org.hl7.fhir.instance.model.api.IBaseResource;
import org.hl7.fhir.r4.model.Patient;
import org.hl7.fhir.r4.model.Element;
import org.hl7.fhir.r4.model.MessageHeader;
import org.hl7.fhir.r4.model.Parameters;
import org.hl7.fhir.r4.model.Parameters.ParametersParameterComponent;
import org.hl7.fhir.r4.model.Resource;
import org.hl7.fhir.r4.model.Type;

import ca.uhn.fhir.util.ExtensionUtil;
import lombok.extern.slf4j.Slf4j;

/**
 * Property is a facade over the various version specific model instances
 * of Property.
 */
<span class="fc" id="L30">@Slf4j</span>
public class Property {
	/**
	 * Get the named property from the object.
	 * @param b	The Element to get values from
	 * @param propertyName	The name of property to get the values from.
	 * @return A list of values on the element.
	 * @throws FHIRException When a FHIRException occurs in the HAPI framework
	 */
	public static Property getProperty(IBase b, String propertyName) throws FHIRException { // NOSONAR ? intentional
<span class="pc bpc" id="L40" title="1 of 2 branches missed.">		if (&quot;resolve()&quot;.equals(propertyName)) {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">			if (b instanceof IBaseReference ref) {</span>
<span class="nc" id="L42">				IBaseResource res = (IBaseResource)ref.getUserData(&quot;Resource&quot;);</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">				return res == null ? null : new Property(res);</span>
			} else {
<span class="nc" id="L45">				throw new IllegalArgumentException(&quot;Cannot resolve() a &quot; + b.getClass().getSimpleName());</span>
			}
<span class="pc bpc" id="L47" title="1 of 4 branches missed.">		} else if (Character.isUpperCase(propertyName.charAt(0)) &amp;&amp; b instanceof IBaseReference ref) {</span>
			// Using XXX.reference.ResourceName is short-hand for resolve().ResourceName
			// when b is a reference.
<span class="fc" id="L50">			IBaseResource res = (IBaseResource)ref.getUserData(&quot;Resource&quot;);</span>
<span class="pc bpc" id="L51" title="1 of 4 branches missed.">			return (res != null &amp;&amp; res.fhirType().equals(propertyName)) ? new Property(res) : null;</span>
		}
<span class="pc bpc" id="L53" title="1 of 2 branches missed.">		if (propertyName.contains(&quot;-&quot;)) {</span>
			// The actual property is for an extension from us-core
<span class="nc bnc" id="L55" title="All 2 branches missed.">			String extensionName = (propertyName.startsWith(&quot;us-core-&quot;) ?</span>
<span class="nc" id="L56">					PathUtils.US_CORE_EXT_PREFIX : PathUtils.FHIR_EXT_PREFIX) + propertyName;</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">			if (ExtensionUtil.hasExtension(b, extensionName)) {</span>
<span class="nc" id="L58">				return new Property(ExtensionUtil.getExtensionByUrl(b, extensionName));</span>
			} else {
<span class="nc" id="L60">				return null;</span>
			}
		}
		
<span class="fc" id="L64">		String[] theName = new String[] { propertyName };</span>
<span class="fc" id="L65">		String type = PathUtils.getType(b, theName );</span>
<span class="fc" id="L66">		propertyName = theName[0];</span>

<span class="pc bpc" id="L68" title="5 of 6 branches missed.">		switch (b.getClass().getPackageName()) {</span>
		case &quot;org.hl7.fhir.r4.model&quot;:
<span class="fc bfc" id="L70" title="All 2 branches covered.">			if (b instanceof Element e) {</span>
<span class="fc" id="L71">				return new Property(e, propertyName, type);</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">			} else if (b instanceof Resource r) {</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">				if (b instanceof Parameters params) {</span>
<span class="fc bfc" id="L74" title="All 2 branches covered.">					for (ParametersParameterComponent param : params.getParameter()) {</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">						if (StringUtils.equals(param.getName(), propertyName)) {</span>
<span class="fc" id="L76">							return new Property(propertyName, param.getValue());</span>
						}
<span class="fc" id="L78">					}</span>
<span class="fc" id="L79">					return null;</span>
				}
<span class="fc" id="L81">				return new Property(r, propertyName, type);</span>
			}
<span class="nc" id="L83">			break;</span>
		case &quot;org.hl7.fhir.r4b.model&quot;:
<span class="nc bnc" id="L85" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.r4b.model.Element e) {</span>
<span class="nc" id="L86">				return new Property(e, propertyName, type);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.r4b.model.Resource r) {</span>
<span class="nc" id="L88">				return new Property(r, propertyName, type);</span>
			}
<span class="nc" id="L90">			break;</span>
		case &quot;org.hl7.fhir.r5.model&quot;:
<span class="nc bnc" id="L92" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.r5.model.Element e) {</span>
<span class="nc" id="L93">				return new Property(e, propertyName, type);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.r5.model.Resource r) {</span>
<span class="nc" id="L95">				return new Property(r, propertyName, type);</span>
			}
<span class="nc" id="L97">			break;</span>
		case &quot;org.hl7.fhir.dstu3.model&quot;:
<span class="nc bnc" id="L99" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.dstu3.model.Element e) {</span>
<span class="nc" id="L100">				return new Property(e, propertyName, type);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.dstu3.model.Resource r) {</span>
<span class="nc" id="L102">				return new Property(r, propertyName, type);</span>
			}
<span class="nc" id="L104">			break;</span>
		case &quot;org.hl7.fhir.dstu2.model&quot;:
<span class="nc bnc" id="L106" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.dstu2.model.Element e) {</span>
<span class="nc" id="L107">				return new Property(e, propertyName, type);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.dstu2.model.Resource r) {</span>
<span class="nc" id="L109">				return new Property(r, propertyName, type);</span>
			}
<span class="nc" id="L111">			break;</span>
		default:
<span class="nc" id="L113">			throw new FHIRException(&quot;Unsupported package &quot; + b.getClass().getPackageName());</span>
		}
<span class="nc" id="L115">		throw new FHIRException(&quot;Not an Element&quot;);</span>
	}
	
	/**
	 * Get the named property from the object.
	 * 
	 * NOTE: This function is incomplete as it does not call setProperty for singleton 
	 * properties.  However what it does is sufficient for current needs.
	 * 
	 * @param b	The Element to get values from
	 * @param propertyName	The name of property to get the values from.
	 * @return A list of values on the element.
	 * @throws FHIRException When a the HAPI FHIR package is not present 
	 */
	public static IBase makeProperty(IBase b, String propertyName) throws FHIRException { // NOSONAR ? intentional
<span class="nc bnc" id="L130" title="All 6 branches missed.">		switch (b.getClass().getPackageName()) {</span>
		case &quot;org.hl7.fhir.r4.model&quot;:
<span class="nc bnc" id="L132" title="All 2 branches missed.">			if (b instanceof Element e) {</span>
<span class="nc" id="L133">				return e.makeProperty(propertyName.hashCode(), propertyName);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			} else if (b instanceof Resource r) {</span>
<span class="nc" id="L135">				return r.makeProperty(propertyName.hashCode(), propertyName);</span>
			}
<span class="nc" id="L137">			break;</span>
		case &quot;org.hl7.fhir.r4b.model&quot;:
<span class="nc bnc" id="L139" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.r4b.model.Element e) {</span>
<span class="nc" id="L140">				return e.makeProperty(propertyName.hashCode(), propertyName);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.r4b.model.Resource r) {</span>
<span class="nc" id="L142">				return r.makeProperty(propertyName.hashCode(), propertyName);</span>
			}
<span class="nc" id="L144">			break;</span>
		case &quot;org.hl7.fhir.r5.model&quot;:
<span class="nc bnc" id="L146" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.r5.model.Element e) {</span>
<span class="nc" id="L147">				return e.makeProperty(propertyName.hashCode(), propertyName);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.r4.model.Resource r) {</span>
<span class="nc" id="L149">				return r.makeProperty(propertyName.hashCode(), propertyName);</span>
			}
<span class="nc" id="L151">			break;</span>
		case &quot;org.hl7.fhir.dstu3.model&quot;:
<span class="nc bnc" id="L153" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.dstu3.model.Element e) {</span>
<span class="nc" id="L154">				return e.makeProperty(propertyName.hashCode(), propertyName);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.dstu3.model.Resource r) {</span>
<span class="nc" id="L156">				return r.makeProperty(propertyName.hashCode(), propertyName);</span>
			}
<span class="nc" id="L158">			break;</span>
		case &quot;org.hl7.fhir.dstu2.model&quot;:
<span class="nc bnc" id="L160" title="All 2 branches missed.">			if (b instanceof org.hl7.fhir.dstu2.model.Element e) {</span>
<span class="nc" id="L161">				org.hl7.fhir.dstu2.model.Property p = e.getChildByName(propertyName);</span>
				// This is a ton of ick.
				try {
<span class="nc bnc" id="L164" title="All 2 branches missed.">					if (p.getMaxCardinality() &gt; 1) {</span>
<span class="nc" id="L165">						return e.addChild(propertyName);</span>
					} else {
<span class="nc" id="L167">						e.setProperty(propertyName, null);</span>
<span class="nc" id="L168">						return null;</span>
					}
<span class="nc" id="L170">				} catch (FHIRException ex) {</span>
					// Cannot add the specified child, assume it is a singleton
				}
<span class="nc bnc" id="L173" title="All 2 branches missed.">			} else if (b instanceof org.hl7.fhir.dstu2.model.Resource r) {</span>
<span class="nc" id="L174">				return r.addChild(propertyName);</span>
			}
<span class="nc" id="L176">			break;</span>
		default:
<span class="nc" id="L178">			throw new FHIRException(&quot;Unsupported package &quot; + b.getClass().getPackageName());</span>
		}
<span class="nc" id="L180">		throw new FHIRException(&quot;Not an Element&quot;);</span>
	}
	/**
	 * Get values for a property of a FHIR Element
	 * @param b	The FHIR item to get a property of
	 * @param propertyName	The name of the property
	 * @return	The new property
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public static List&lt;IBase&gt; getValues(IBase b, String propertyName) {
<span class="fc" id="L190">		 Property prop = getProperty(b, propertyName);</span>
<span class="fc bfc" id="L191" title="All 2 branches covered.">		 return prop == null ? Collections.emptyList() : (List&lt;IBase&gt;) prop.getValues();</span>
	}
	private final Object property;
	private final Method getName;
	private final Method getTypeCode;
	private final Method getDefinition;
	private final Method getMinCardinality;
	private final Method getMaxCardinality;
	private final Method getValues;
	private String name;
	private String typeCode;
	private String definition;
<span class="pc" id="L203">	private int minCardinality = -1;</span>
<span class="pc" id="L204">	private int maxCardinality = -1;</span>
<span class="pc" id="L205">	private List&lt;? super IBase&gt; values = null;</span>
	
<span class="fc" id="L207">	private Property(Object property, String type) {</span>
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">		if (property == null) {</span>
<span class="nc" id="L209">			throw new NullPointerException(&quot;Property cannot be null&quot;);</span>
		}
<span class="fc" id="L211">		this.property = property;</span>
<span class="fc" id="L212">		Class&lt;?&gt; clazz = property.getClass();</span>
<span class="fc" id="L213">		String method = null;</span>
		try {
<span class="fc" id="L215">			getName = clazz.getDeclaredMethod(method = &quot;getName&quot;);  // NOSONAR assignment OK</span>
<span class="fc" id="L216">			getTypeCode = clazz.getDeclaredMethod(method = &quot;getTypeCode&quot;);	// NOSONAR assignment OK</span>
<span class="fc" id="L217">			getDefinition = clazz.getDeclaredMethod(method = &quot;getDefinition&quot;);	// NOSONAR assignment OK</span>
<span class="fc" id="L218">			getMinCardinality = clazz.getDeclaredMethod(method = &quot;getMinCardinality&quot;);	// NOSONAR assignment OK</span>
<span class="fc" id="L219">			getMaxCardinality = clazz.getDeclaredMethod(method = &quot;getMaxCardinality&quot;);	// NOSONAR assignment OK</span>
<span class="fc" id="L220">			getValues = clazz.getDeclaredMethod(method = &quot;getValues&quot;);	// NOSONAR assignment OK</span>
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">			if (type != null) {</span>
<span class="nc" id="L222">				typeCode = type;</span>
			}
<span class="nc" id="L224">		} catch (NoSuchMethodException | SecurityException e) {</span>
<span class="nc" id="L225">			String msg = &quot;Cannot access Propery.&quot; + method + &quot;() method&quot;; </span>
<span class="nc" id="L226">			log.error(&quot;{} : {}&quot;, msg, e.getMessage(), e);</span>
<span class="nc" id="L227">			throw new ServiceConfigurationError(msg, e);</span>
<span class="fc" id="L228">		}</span>
<span class="fc" id="L229">	}</span>
	
<span class="nc" id="L231">	private Property(IBaseExtension&lt;?, ?&gt; extension) {</span>
<span class="nc" id="L232">		property = extension;</span>
<span class="nc" id="L233">		name = StringUtils.substringAfter(extension.getUrl(), &quot;StructureDefinition/&quot;);</span>
<span class="nc" id="L234">		typeCode = &quot;Extension&quot;;</span>
<span class="nc" id="L235">		definition = &quot;Optional Extension Element - found in all resources.&quot;;</span>
<span class="nc" id="L236">		minCardinality = 0;</span>
<span class="nc" id="L237">		maxCardinality = Integer.MAX_VALUE;</span>
<span class="nc" id="L238">		values = Collections.singletonList(extension.getValue());</span>
<span class="nc" id="L239">		getName = null;</span>
<span class="nc" id="L240">		getTypeCode = null;</span>
<span class="nc" id="L241">		getDefinition = null;</span>
<span class="nc" id="L242">		getMinCardinality = null;</span>
<span class="nc" id="L243">		getMaxCardinality = null;</span>
<span class="nc" id="L244">		getValues = null;</span>
<span class="nc" id="L245">	}</span>
	
	/**
	 * Create a Property for a resource
	 * @param res	The resource
	 */
<span class="fc" id="L251">	public Property(IBaseResource res) {</span>
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">		if (res == null) {</span>
<span class="nc" id="L253">			throw new NullPointerException(&quot;res cannot be null&quot;);</span>
		}
<span class="fc" id="L255">		property = res;</span>
<span class="fc" id="L256">		name = &quot;resolve()&quot;;</span>
<span class="fc" id="L257">		typeCode = res.fhirType();</span>
<span class="fc" id="L258">		definition = res.fhirType();</span>
<span class="fc" id="L259">		minCardinality = 0;</span>
<span class="fc" id="L260">		maxCardinality = Integer.MAX_VALUE;</span>
<span class="fc" id="L261">		values = Collections.singletonList(res);</span>
<span class="fc" id="L262">		getName = null;</span>
<span class="fc" id="L263">		getTypeCode = null;</span>
<span class="fc" id="L264">		getDefinition = null;</span>
<span class="fc" id="L265">		getMinCardinality = null;</span>
<span class="fc" id="L266">		getMaxCardinality = null;</span>
<span class="fc" id="L267">		getValues = null;</span>
<span class="fc" id="L268">	}</span>
	
	/**
	 * Create a property for a known property with the given name.
	 * @param propertyName	The property
	 * @param value	The value of the property
	 */
<span class="fc" id="L275">	public Property(String propertyName, Type value) {</span>
<span class="fc" id="L276">		property = value;</span>
<span class="fc" id="L277">		name = propertyName;</span>
<span class="fc" id="L278">		typeCode = value.fhirType();</span>
<span class="fc" id="L279">		definition = value.fhirType();</span>
<span class="fc" id="L280">		minCardinality = 0;</span>
<span class="fc" id="L281">		maxCardinality = 1;</span>
<span class="fc" id="L282">		values = Collections.singletonList(value);</span>
<span class="fc" id="L283">		getName = null;</span>
<span class="fc" id="L284">		getTypeCode = null;</span>
<span class="fc" id="L285">		getDefinition = null;</span>
<span class="fc" id="L286">		getMinCardinality = null;</span>
<span class="fc" id="L287">		getMaxCardinality = null;</span>
<span class="fc" id="L288">		getValues = null;</span>
<span class="fc" id="L289">	}</span>


	
	/**
	 * Create a new Property accessing an R4 Property
	 * @param property The R4 Property
	 * @param type The specific subtype or null (for properties like Patient.deceased)
	 */
	public Property(org.hl7.fhir.r4.model.Property property, String type) {
<span class="fc" id="L299">		this((Object)property, type);</span>
<span class="fc" id="L300">	}</span>

	/**
	 * Create a new Property accessing an R4b Property
	 * @param property The R4b Property
	 * @param type The specific subtype or null (for properties like Patient.deceased)
	 */
	public Property(org.hl7.fhir.r4b.model.Property property, String type) {
<span class="nc" id="L308">		this((Object)property, type);</span>
<span class="nc" id="L309">	}</span>

	/**
	 * Create a new Property accessing an R5 Property
	 * @param property The R5 Property
	 * @param type The specific subtype or null (for properties like Patient.deceased)
	 */
	public Property(org.hl7.fhir.r5.model.Property property, String type) {
<span class="nc" id="L317">		this((Object)property, type);</span>
<span class="nc" id="L318">	}</span>

	/**
	 * Create a new Property accessing a DSTU3 Property
	 * @param property The DSTU3 Property
	 * @param type The specific subtype or null (for properties like Patient.deceased)
	 */
	public Property(org.hl7.fhir.dstu3.model.Property property, String type) {
<span class="nc" id="L326">		this((Object)property, type);</span>
<span class="nc" id="L327">	}</span>

	/**
	 * Create a new Property accessing a DSTU2 Property
	 * @param property The DSTU2 Property
	 * @param type The specific subtype or null (for properties like Patient.deceased)
	 */
	public Property(org.hl7.fhir.dstu2.model.Property property, String type) {
<span class="nc" id="L335">		this((Object)property, type);</span>
<span class="nc" id="L336">	}</span>
	
	/** 
	 * Create a property of an R4 Resource
	 * @param r	The R4 Resource
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(Resource r, String propertyName, String type) {
<span class="fc" id="L345">		this(getChildByName(r, propertyName), type);</span>
<span class="fc" id="L346">	}</span>

	/** 
	 * Create a property of an R4 Element
	 * @param e	The R4 Element
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(Element e, String propertyName, String type) {
<span class="fc" id="L355">		this(e.getChildByName(propertyName), type);</span>
<span class="fc" id="L356">	}</span>

	private static Object getChildByName(Resource r, String propertyName) {
<span class="pc bpc" id="L359" title="3 of 4 branches missed.">		if (&quot;eventCoding&quot;.equals(propertyName) &amp;&amp; r instanceof MessageHeader mh) {</span>
<span class="nc" id="L360">			return new org.hl7.fhir.r4.model.Property(</span>
				propertyName, &quot;Coding&quot;, 
				&quot;Code that identifies the event this message represents and connects it with its definition.&quot;, 
<span class="nc" id="L363">				0, 1, mh.getEventCoding()); </span>
		}
<span class="fc" id="L365">		return r.getChildByName(propertyName);</span>
	}

	/** 
	 * Create a property of an R4B Element
	 * @param e	The R4B Element
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.r4b.model.Element e, String propertyName, String type) {
<span class="nc" id="L375">		this(e.getChildByName(propertyName), type);</span>
<span class="nc" id="L376">	}</span>

	/** 
	 * Create a property of an R4B Resource
	 * @param r	The R4B Resource
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.r4b.model.Resource r, String propertyName, String type) {
<span class="nc" id="L385">		this(r.getChildByName(propertyName), type);</span>
<span class="nc" id="L386">	}</span>

	/** 
	 * Create a property of an R5 Element
	 * @param e	The R5 Element
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.r5.model.Element e, String propertyName, String type) {
<span class="nc" id="L395">		this(e.getChildByName(propertyName), type);</span>
<span class="nc" id="L396">	}</span>

	/** 
	 * Create a property of an R5 Resource
	 * @param r	The R5 Resource
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.r5.model.Resource r, String propertyName, String type) {
<span class="nc" id="L405">		this(r.getChildByName(propertyName), type);</span>
<span class="nc" id="L406">	}</span>

	/** 
	 * Create a property of an STU3 Element
	 * @param e	The STU3 Element
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.dstu3.model.Element e, String propertyName, String type) {
<span class="nc" id="L415">		this(e.getChildByName(propertyName), type);</span>
<span class="nc" id="L416">	}</span>

	/** 
	 * Create a property of an STU3 Resource
	 * @param r	The STU3 Resource
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.dstu3.model.Resource r, String propertyName, String type) {
<span class="nc" id="L425">		this(r.getChildByName(propertyName), type);</span>
<span class="nc" id="L426">	}</span>

	/** 
	 * Create a property of an STU2 Element
	 * @param e	The STU2 Element
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.dstu2.model.Element e, String propertyName, String type) {
<span class="nc" id="L435">		this(e.getChildByName(propertyName), type);</span>
<span class="nc" id="L436">	}</span>

	/** 
	 * Create a property of an STU2 Resource
	 * @param r	The STU2 Resource
	 * @param propertyName The property name
	 * @param type	The type for the property
	 */
	public Property(org.hl7.fhir.dstu2.model.Resource r, String propertyName, String type) {
<span class="nc" id="L445">		this(r.getChildByName(propertyName), type);</span>
<span class="nc" id="L446">	}</span>

	/**
	 * Get the name of the property
	 * @return The name of the property
	 */
	public String getName() {
		try {
<span class="nc bnc" id="L454" title="All 2 branches missed.">			if (name == null) {</span>
<span class="nc" id="L455">				name = (String) getName.invoke(property);</span>
			}
<span class="nc" id="L457">			return name;</span>
<span class="nc" id="L458">		} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L459">			throw new FHIRException(&quot;Error retriving property name&quot;, e);</span>
		}
	}
	
	/**
	 * Get the type of the property
	 * @return The type of the property
	 */
	public String getTypeCode() {
		try {
<span class="nc bnc" id="L469" title="All 2 branches missed.">			if (typeCode == null) {</span>
<span class="nc" id="L470">				typeCode = (String) getTypeCode.invoke(property);</span>
			}
<span class="nc" id="L472">			return typeCode;</span>
<span class="nc" id="L473">		} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L474">			throw new FHIRException(&quot;Error retriving property type&quot;, e);</span>
		}
	}

	/**
	 * Get the class representing the type for this property
	 * @return The class representing the type
	 * @throws ClassNotFoundException If the class cannot be found.
	 */
	public Class&lt;IBase&gt; getType() throws ClassNotFoundException {
<span class="nc" id="L484">		String type = getTypeCode();</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">		if (Character.isLowerCase(type.charAt(0))) {</span>
			// Convert a primitive to it's HAPI type name.
<span class="nc" id="L487">			type = Character.toUpperCase(type.charAt(0)) + type.substring(1) + &quot;Type&quot;;</span>
		}
<span class="nc" id="L489">		type = property.getClass().getPackageName() + type;</span>
		@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L491">		Class&lt;IBase&gt; t = (Class&lt;IBase&gt;) Patient.class.getClassLoader().loadClass(type); </span>
<span class="nc" id="L492">		return t;</span>
	}

	/**
	 * Get the description of the property
	 * @return The description of the property
	 */
	public String getDefinition() {
		try {
<span class="nc bnc" id="L501" title="All 2 branches missed.">			if (definition == null) {</span>
<span class="nc" id="L502">				definition = (String) getDefinition.invoke(property);</span>
			}
<span class="nc" id="L504">			return definition;</span>
<span class="nc" id="L505">		} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L506">			throw new FHIRException(&quot;Error retriving property definition&quot;, e);</span>
		}
	}
	
	/**
	 * Get the minimum cardinality of the property
	 * @return The minimum cardinality of the property
	 */
	public int getMinCardinality() {
		try {
<span class="nc bnc" id="L516" title="All 2 branches missed.">			if (minCardinality &lt; 0) {</span>
<span class="nc" id="L517">				minCardinality = (int) getMinCardinality.invoke(property);</span>
			}
<span class="nc" id="L519">			return minCardinality;</span>
<span class="nc" id="L520">		} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L521">			throw new FHIRException(&quot;Error retriving property minCardinality&quot;, e);</span>
		}
	}
	
	/**
	 * Get the maximum cardinality of the property
	 * @return The maximum cardinality of the property
	 */
	public int getMaxCardinality() {
		try {
<span class="nc bnc" id="L531" title="All 2 branches missed.">			if (maxCardinality &lt; 0) {</span>
<span class="nc" id="L532">				maxCardinality = (int) getMaxCardinality.invoke(property);</span>
			}
<span class="nc" id="L534">			return maxCardinality;</span>
<span class="nc" id="L535">		} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L536">			throw new FHIRException(&quot;Error retriving property maxCardinality&quot;, e);</span>
		}
	}
	
	/**
	 * Get the values in the property
	 * @return The values in the property
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	List&lt;? super IBase&gt; getValues() { // NOSONAR ? intentional
		try {
<span class="fc bfc" id="L547" title="All 2 branches covered.">			if (values == null) {</span>
<span class="fc" id="L548">				values = (List&lt;? super IBase&gt;) getValues.invoke(property);</span>
			}
<span class="fc" id="L550">			return values;</span>
<span class="nc" id="L551">		} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L552">			throw new FHIRException(&quot;Error retriving property values&quot;, e);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>